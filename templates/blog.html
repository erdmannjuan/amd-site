{% extends "base.html" %}

{% block content %}
<!-- Page Hero -->
<section class="page-hero">
    <div class="container">
        <span class="section-label">{{ page.label or "Blog" }}</span>
        <h1 class="page-title">{{ page.hero_title or "Automation Insights" }}</h1>
        <p class="page-subtitle">{{ page.hero_subtitle or "Expert perspectives on manufacturing automation, robotics, and industry trends" }}</p>
    </div>
</section>

<!-- Blog Filters -->
<section class="blog-filters-section">
    <div class="container">
        <div class="blog-filters">
            <div class="filter-group">
                <label for="category-filter">Category</label>
                <select id="category-filter">
                    <option value="">All Categories</option>
                    {% for category in categories|sort %}
                    <option value="{{ category }}">{{ category }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="filter-group">
                <label for="date-filter">Date Range</label>
                <select id="date-filter">
                    <option value="">All Time</option>
                    <option value="2026">2026</option>
                    <option value="2025">2025</option>
                    <option value="2024">2024</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="search-filter">Search</label>
                <input type="text" id="search-filter" placeholder="Search articles...">
            </div>
            <div class="filter-results">
                {% if pagination %}
                <span>Showing {{ posts|length }} of {{ pagination.total_posts }} articles</span>
                {% else %}
                <span id="results-count">{{ posts|length }}</span> articles
                {% endif %}
                <button id="clear-filters" class="btn-link" style="display: none;">Clear filters</button>
            </div>
        </div>
    </div>
</section>

<!-- Blog Grid -->
<section class="section blog-section">
    <div class="container">
        <div class="blog-grid" id="blog-grid">
            {% for post in posts %}
            <article class="blog-card" data-category="{{ post.category or '' }}" data-date="{{ post.date or '' }}" data-title="{{ post.title|lower }}" data-description="{{ post.description|lower }}">
                {% if post.image %}
                <div class="blog-card-image">
                    <img src="{{ config.site.base_path }}/static/images/{{ post.image }}" alt="{{ post.title }}" loading="lazy" width="800" height="450">
                </div>
                {% endif %}
                <div class="blog-card-body">
                    {% if post.category %}
                    <span class="blog-category">{{ post.category }}</span>
                    {% endif %}
                    <h2><a href="{{ config.site.base_path }}{{ post.url }}">{{ post.title }}</a></h2>
                    <p>{{ post.description }}</p>
                    <div class="blog-meta">
                        {% if post.author %}<span>{{ post.author }}</span>{% endif %}
                        {% if post.date %}<span>{{ post.date }}</span>{% endif %}
                        {% if post.read_time %}<span>{{ post.read_time }} min read</span>{% endif %}
                    </div>
                </div>
            </article>
            {% else %}
            <div class="blog-empty">
                <p>No blog posts yet. Check back soon for automation insights and industry updates.</p>
            </div>
            {% endfor %}
        </div>
        <div class="blog-empty" id="no-results" style="display: none;">
            <p>No articles match your filters. Try adjusting your search criteria.</p>
        </div>

        {% if pagination and pagination.total_pages > 1 %}
        <!-- Pagination -->
        <nav class="blog-pagination" aria-label="Blog pagination">
            {% if pagination.has_prev %}
            <a href="{{ config.site.base_path }}{{ pagination.prev_url }}" class="pagination-btn pagination-prev">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15,18 9,12 15,6"/></svg>
                Previous
            </a>
            {% else %}
            <span class="pagination-btn pagination-prev disabled">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15,18 9,12 15,6"/></svg>
                Previous
            </span>
            {% endif %}

            <div class="pagination-numbers">
                {% for page_num in pagination.pages %}
                    {% if page_num == pagination.current_page %}
                    <span class="pagination-num active">{{ page_num }}</span>
                    {% elif page_num == 1 %}
                    <a href="{{ config.site.base_path }}/blog/" class="pagination-num">{{ page_num }}</a>
                    {% elif page_num <= 3 or page_num > pagination.total_pages - 2 or (page_num >= pagination.current_page - 1 and page_num <= pagination.current_page + 1) %}
                    <a href="{{ config.site.base_path }}/blog/page/{{ page_num }}/" class="pagination-num">{{ page_num }}</a>
                    {% elif page_num == 4 and pagination.current_page > 5 %}
                    <span class="pagination-ellipsis">...</span>
                    {% elif page_num == pagination.total_pages - 2 and pagination.current_page < pagination.total_pages - 4 %}
                    <span class="pagination-ellipsis">...</span>
                    {% endif %}
                {% endfor %}
            </div>

            {% if pagination.has_next %}
            <a href="{{ config.site.base_path }}{{ pagination.next_url }}" class="pagination-btn pagination-next">
                Next
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9,6 15,12 9,18"/></svg>
            </a>
            {% else %}
            <span class="pagination-btn pagination-next disabled">
                Next
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9,6 15,12 9,18"/></svg>
            </span>
            {% endif %}
        </nav>
        {% endif %}
    </div>
</section>

<!-- CTA Section -->
<section class="cta-section">
    <div class="container">
        <h2>Stay Updated</h2>
        <p>Get the latest automation insights delivered to your inbox.</p>
        <a href="{{ config.site.base_path }}/contact/" class="btn btn-white btn-lg">Subscribe</a>
    </div>
</section>
{% endblock %}

{% block scripts_extra %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const categoryFilter = document.getElementById('category-filter');
    const dateFilter = document.getElementById('date-filter');
    const searchFilter = document.getElementById('search-filter');
    const clearBtn = document.getElementById('clear-filters');
    const resultsCount = document.getElementById('results-count');
    const blogGrid = document.getElementById('blog-grid');
    const noResults = document.getElementById('no-results');
    const cards = document.querySelectorAll('.blog-card');

    function filterCards() {
        const category = categoryFilter.value.toLowerCase();
        const year = dateFilter.value;
        const search = searchFilter.value.toLowerCase().trim();

        let visibleCount = 0;

        cards.forEach(function(card) {
            const cardCategory = (card.dataset.category || '').toLowerCase();
            const cardDate = card.dataset.date || '';
            const cardTitle = card.dataset.title || '';
            const cardDescription = card.dataset.description || '';

            let showCard = true;

            // Category filter
            if (category && cardCategory !== category) {
                showCard = false;
            }

            // Date filter
            if (year && !cardDate.startsWith(year)) {
                showCard = false;
            }

            // Search filter
            if (search && !cardTitle.includes(search) && !cardDescription.includes(search)) {
                showCard = false;
            }

            if (showCard) {
                card.style.display = '';
                visibleCount++;
            } else {
                card.style.display = 'none';
            }
        });

        resultsCount.textContent = visibleCount;

        // Show/hide no results message
        if (visibleCount === 0) {
            noResults.style.display = 'block';
            blogGrid.style.display = 'none';
        } else {
            noResults.style.display = 'none';
            blogGrid.style.display = '';
        }

        // Show/hide clear button
        if (category || year || search) {
            clearBtn.style.display = 'inline';
        } else {
            clearBtn.style.display = 'none';
        }
    }

    function clearFilters() {
        categoryFilter.value = '';
        dateFilter.value = '';
        searchFilter.value = '';
        filterCards();
    }

    categoryFilter.addEventListener('change', filterCards);
    dateFilter.addEventListener('change', filterCards);
    searchFilter.addEventListener('input', filterCards);
    clearBtn.addEventListener('click', clearFilters);

    // Check URL params for initial filter
    const urlParams = new URLSearchParams(window.location.search);
    const urlCategory = urlParams.get('category');
    const urlYear = urlParams.get('year');

    if (urlCategory) {
        // URL decode and find matching option (case-insensitive)
        const decodedCategory = decodeURIComponent(urlCategory);
        const options = categoryFilter.querySelectorAll('option');
        for (let opt of options) {
            if (opt.value.toLowerCase() === decodedCategory.toLowerCase()) {
                categoryFilter.value = opt.value;
                break;
            }
        }
    }
    if (urlYear) {
        dateFilter.value = urlYear;
    }
    if (urlCategory || urlYear) {
        filterCards();
    }
});
</script>
{% endblock %}
