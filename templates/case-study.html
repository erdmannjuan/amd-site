{% extends "base.html" %}

{% block head_extra %}
<!-- Case Study Article Schema -->
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "headline": "{{ page.title }}",
    "description": "{{ page.description or '' }}",
    "image": "{{ config.site.url }}/static/images/{{ page.hero_image | default('case-studies/default.jpg') }}",
    "author": {
        "@type": "Organization",
        "name": "{{ config.site.name }}",
        "url": "{{ config.site.url }}"
    },
    "publisher": {
        "@type": "Organization",
        "name": "{{ config.site.name }}",
        "logo": {
            "@type": "ImageObject",
            "url": "{{ config.site.url }}/static/images/logo.png"
        }
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "{{ config.site.url }}{{ page.url }}"
    },
    "about": {
        "@type": "Product",
        "name": "{{ page.title | replace(':', ' -') }}",
        "description": "{{ page.solution.summary | default(page.description) }}",
        "brand": {
            "@type": "Organization",
            "name": "AMD Machines"
        },
        "manufacturer": {
            "@type": "Organization",
            "name": "AMD Machines",
            "url": "{{ config.site.url }}"
        },
        "category": "Industrial Automation Equipment"
    }
}
</script>

<!-- Custom Machine/Service Schema for SEO -->
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Service",
    "serviceType": "Custom Industrial Automation",
    "name": "{{ page.industry }} Automation Solution",
    "description": "{{ page.description }}",
    "provider": {
        "@type": "Organization",
        "name": "AMD Machines",
        "url": "{{ config.site.url }}",
        "telephone": "{{ config.social.phone }}",
        "address": {
            "@type": "PostalAddress",
            "streetAddress": "420 N Wabash Ave",
            "addressLocality": "Chicago",
            "addressRegion": "IL",
            "postalCode": "60611",
            "addressCountry": "US"
        }
    },
    "areaServed": {
        "@type": "Country",
        "name": "United States"
    },
    "hasOfferCatalog": {
        "@type": "OfferCatalog",
        "name": "{{ page.industry }} Automation Solutions",
        "itemListElement": [
            {% if page.solutions_used %}
            {% for sol in page.solutions_used %}
            {
                "@type": "Offer",
                "itemOffered": {
                    "@type": "Service",
                    "name": "{{ sol.name }}"
                }
            }{% if not loop.last %},{% endif %}
            {% endfor %}
            {% endif %}
        ]
    }
}
</script>

<!-- Aggregate Rating Schema (if testimonial exists) -->
{% if page.testimonial %}
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Review",
    "itemReviewed": {
        "@type": "Product",
        "name": "{{ page.title | replace(':', ' -') }}"
    },
    "reviewRating": {
        "@type": "Rating",
        "ratingValue": "5",
        "bestRating": "5"
    },
    "author": {
        "@type": "Organization",
        "name": "{{ page.client | default('Manufacturing Client') }}"
    },
    "reviewBody": "{{ page.testimonial | default('Excellent automation solution with measurable ROI.') }}"
}
</script>
{% endif %}
{% endblock %}

{% block content %}
<!-- Case Study Hero -->
<section class="case-study-hero">
    <div class="case-study-hero-bg" {% if page.hero_image %}style="background-image: url('{{ config.site.base_path }}/static/images/{{ page.hero_image }}')"{% endif %}></div>
    <div class="case-study-hero-overlay"></div>
    <div class="container">
        <div class="case-study-hero-content">
            <nav class="breadcrumb-light">
                <a href="{{ config.site.base_path }}/">Home</a>
                <span>/</span>
                <a href="{{ config.site.base_path }}/case-studies/">Case Studies</a>
                <span>/</span>
                <span>{{ page.industry }}</span>
            </nav>
            <span class="case-study-industry-badge">{{ page.industry }}</span>
            <h1>{{ page.title }}</h1>
            <p class="case-study-tagline">{{ page.tagline or page.description }}</p>
        </div>
    </div>
</section>

<!-- Key Results Bar -->
<section class="case-study-results-bar">
    <div class="container">
        <div class="results-bar-grid">
            {% for result in page.key_results %}
            <div class="result-item">
                <span class="result-number">{{ result.value }}</span>
                <span class="result-label">{{ result.label }}</span>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- Quick Nav -->
<section class="case-study-nav">
    <div class="container">
        <div class="case-study-nav-inner">
            <a href="#overview" class="case-nav-link active">Overview</a>
            <a href="#challenge" class="case-nav-link">Challenge</a>
            <a href="#solution" class="case-nav-link">Solution</a>
            <a href="#results" class="case-nav-link">Results</a>
            {% if page.specifications %}<a href="#specs" class="case-nav-link">Specifications</a>{% endif %}
            {% if page.gallery %}<a href="#gallery" class="case-nav-link">Gallery</a>{% endif %}
        </div>
    </div>
</section>

<!-- Main Content -->
<section class="case-study-content">
    <div class="container">
        <div class="case-study-layout">
            <!-- Main Column -->
            <div class="case-study-main">
                <!-- Overview -->
                <div class="case-study-section" id="overview">
                    <div class="case-study-intro">
                        <div class="client-info">
                            {% if page.client_logo %}
                            <img src="{{ config.site.base_path }}/static/images/{{ page.client_logo }}" alt="{{ page.client }}" class="client-logo" width="200" height="80" loading="lazy">
                            {% endif %}
                            <div class="client-details">
                                <span class="client-label">Client</span>
                                <span class="client-name">{{ page.client or 'Confidential' }}</span>
                            </div>
                        </div>
                        <div class="project-meta">
                            {% if page.location %}
                            <div class="meta-item">
                                <span class="meta-label">Location</span>
                                <span class="meta-value">{{ page.location }}</span>
                            </div>
                            {% endif %}
                            {% if page.timeline %}
                            <div class="meta-item">
                                <span class="meta-label">Timeline</span>
                                <span class="meta-value">{{ page.timeline }}</span>
                            </div>
                            {% endif %}
                            {% if page.project_value %}
                            <div class="meta-item">
                                <span class="meta-label">Project Scope</span>
                                <span class="meta-value">{{ page.project_value }}</span>
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="case-study-body prose">
                        {{ content | safe }}
                    </div>
                </div>

                <!-- Challenge -->
                {% if page.challenge %}
                <div class="case-study-section" id="challenge">
                    <h2><span class="section-number">01</span>The Challenge</h2>
                    <div class="challenge-content">
                        <p class="challenge-summary">{{ page.challenge.summary }}</p>
                        {% if page.challenge.points %}
                        <ul class="challenge-list">
                            {% for point in page.challenge.points %}
                            <li>{{ point }}</li>
                            {% endfor %}
                        </ul>
                        {% endif %}
                    </div>
                </div>
                {% endif %}

                <!-- Solution -->
                {% if page.solution %}
                <div class="case-study-section" id="solution">
                    <h2><span class="section-number">02</span>Our Solution</h2>
                    <div class="solution-content">
                        <p class="solution-summary">{{ page.solution.summary }}</p>
                        {% if page.solution.components %}
                        <div class="solution-components">
                            {% for component in page.solution.components %}
                            <div class="solution-component">
                                <h3>{{ component.name }}</h3>
                                <p>{{ component.description }}</p>
                            </div>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endif %}

                <!-- Results -->
                {% if page.results %}
                <div class="case-study-section" id="results">
                    <h2><span class="section-number">03</span>The Results</h2>
                    <div class="results-content">
                        <p class="results-summary">{{ page.results.summary }}</p>
                        {% if page.results.metrics %}
                        <div class="results-metrics">
                            {% for metric in page.results.metrics %}
                            <div class="result-metric">
                                <span class="metric-value">{{ metric.value }}</span>
                                <span class="metric-label">{{ metric.label }}</span>
                                {% if metric.detail %}<span class="metric-detail">{{ metric.detail }}</span>{% endif %}
                            </div>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endif %}

                <!-- Specifications -->
                {% if page.specifications %}
                <div class="case-study-section" id="specs">
                    <h2>Technical Specifications</h2>
                    <div class="specs-grid">
                        {% for spec in page.specifications %}
                        <div class="spec-item">
                            <span class="spec-label">{{ spec.label }}</span>
                            <span class="spec-value">{{ spec.value }}</span>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- Gallery -->
                {% if page.gallery %}
                <div class="case-study-section" id="gallery">
                    <h2>Project Gallery</h2>
                    <div class="case-gallery">
                        {% for image in page.gallery %}
                        <div class="gallery-item">
                            <img src="{{ config.site.base_path }}/static/images/{{ image.src }}" alt="{{ image.alt }}" loading="lazy" width="800" height="600">
                            {% if image.caption %}<span class="gallery-caption">{{ image.caption }}</span>{% endif %}
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- CTA Box -->
                <div class="case-study-cta-box">
                    <div class="cta-box-content">
                        <h3>Have a similar project?</h3>
                        <p>Our engineering team can help you achieve similar results. Let's discuss your requirements.</p>
                    </div>
                    <a href="{{ config.site.base_path }}/contact/" class="btn btn-primary btn-lg">Start Your Project</a>
                </div>
            </div>

            <!-- Sidebar -->
            <aside class="case-study-sidebar">
                <!-- Solutions Used -->
                {% if page.solutions_used %}
                <div class="sidebar-block">
                    <h3>Solutions Used</h3>
                    <ul class="solutions-used-list">
                        {% for sol in page.solutions_used %}
                        <li>
                            <a href="{{ config.site.base_path }}/solutions/{{ sol.slug }}/">
                                {{ sol.name }} <span>→</span>
                            </a>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}

                <!-- Technologies -->
                {% if page.technologies %}
                <div class="sidebar-block">
                    <h3>Technologies</h3>
                    <div class="tech-tags">
                        {% for tech in page.technologies %}
                        <span class="tech-tag">{{ tech }}</span>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- Download -->
                {% if page.download_pdf %}
                <div class="sidebar-block sidebar-download">
                    <h3>Download Case Study</h3>
                    <p>Get the full case study as a PDF for offline reading.</p>
                    <a href="{{ config.site.base_path }}/static/downloads/{{ page.download_pdf }}" class="btn btn-outline btn-block" download>
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                        Download PDF
                    </a>
                </div>
                {% endif %}

                <!-- Quick Contact -->
                <div class="sidebar-block sidebar-cta-block">
                    <h3>Talk to an Expert</h3>
                    <p>Our engineers have completed hundreds of {{ page.industry | lower }} automation projects.</p>
                    <a href="{{ config.site.base_path }}/contact/" class="btn btn-primary btn-block">Get a Quote</a>
                    <a href="tel:{{ config.social.phone | replace(' ', '') }}" class="sidebar-phone">{{ config.social.phone }}</a>
                </div>
            </aside>
        </div>
    </div>
</section>

<!-- Related Case Studies -->
<section class="related-case-studies">
    <div class="container">
        <div class="section-header-center">
            <h2>More {{ page.industry }} Projects</h2>
            <p>See how we've helped other companies in your industry</p>
        </div>
        <div class="case-studies-grid">
            {% for study in page.related_case_studies %}
            <a href="{{ config.site.base_path }}{{ study.url }}" class="case-study-card">
                <div class="case-card-image" {% if study.image %}style="background-image: url('{{ config.site.base_path }}/static/images/{{ study.image }}')"{% endif %}></div>
                <div class="case-card-content">
                    <span class="case-card-industry">{{ study.industry }}</span>
                    <h3>{{ study.title }}</h3>
                    <p>{{ study.description }}</p>
                    <span class="case-card-link">View Project →</span>
                </div>
            </a>
            {% else %}
            <!-- Fallback to industry-related case studies -->
            {% endfor %}
        </div>
        <div class="section-footer-center">
            <a href="{{ config.site.base_path }}/case-studies/" class="btn btn-outline">View All Case Studies</a>
        </div>
    </div>
</section>

<!-- Final CTA -->
<section class="case-study-final-cta">
    <div class="container">
        <div class="final-cta-content">
            <h2>Ready to transform your manufacturing?</h2>
            <p>Join hundreds of companies that have partnered with AMD Machines for custom automation solutions.</p>
            <div class="final-cta-buttons">
                <a href="{{ config.site.base_path }}/contact/" class="btn btn-white btn-lg">Start Your Project</a>
                <a href="{{ config.site.base_path }}/solutions/" class="btn btn-outline-white btn-lg">Explore Solutions</a>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts_extra %}
<script>
// Sticky nav highlighting
document.addEventListener('DOMContentLoaded', function() {
    const navLinks = document.querySelectorAll('.case-nav-link');
    const sections = document.querySelectorAll('.case-study-section');

    function updateNav() {
        const scrollPos = window.scrollY + 200;

        sections.forEach(section => {
            if (section.offsetTop <= scrollPos && section.offsetTop + section.offsetHeight > scrollPos) {
                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href') === '#' + section.id) {
                        link.classList.add('active');
                    }
                });
            }
        });
    }

    window.addEventListener('scroll', updateNav);
});
</script>
{% endblock %}
