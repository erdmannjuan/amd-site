{% extends "base.html" %}

{% block content %}
<!-- Page Hero -->
<section class="page-hero">
    <div class="container">
        <span class="section-label">{{ page.label or "Contact" }}</span>
        <h1 class="page-title">{{ page.hero_title or "Contact Us" }}</h1>
        <p class="page-subtitle">{{ page.hero_subtitle or "Let's discuss your automation project" }}</p>
    </div>
</section>

<!-- Contact Section -->
<section class="section">
    <div class="container">
        <div class="contact-grid">
            <!-- Contact Info -->
            <div class="contact-info">
                <h2>Get in Touch</h2>
                <p>Ready to discuss your automation project? Our team is here to help. Reach out to start a conversation about your manufacturing challenges.</p>

                <div class="contact-methods">
                    <div class="contact-method">
                        <div class="contact-icon">&#128222;</div>
                        <div>
                            <h3>Phone</h3>
                            <p><a href="tel:{{ config.social.phone | replace('(', '') | replace(')', '') | replace(' ', '') | replace('-', '') }}">{{ config.social.phone }}</a></p>
                        </div>
                    </div>

                    <div class="contact-method">
                        <div class="contact-icon">&#9993;</div>
                        <div>
                            <h3>Email</h3>
                            <p><a href="mailto:{{ config.social.email }}">{{ config.social.email }}</a></p>
                        </div>
                    </div>

                    <div class="contact-method">
                        <div class="contact-icon">&#128205;</div>
                        <div>
                            <h3>Address</h3>
                            <p>{{ config.social.address }}</p>
                        </div>
                    </div>
                </div>

                {% if page.hours %}
                <div class="business-hours">
                    <h3>Business Hours</h3>
                    <ul>
                        {% for hour in page.hours %}
                        <li><strong>{{ hour.days }}:</strong> {{ hour.time }}</li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
            </div>

            <!-- Contact Form -->
            <div class="contact-form-wrapper">
                <h2>Request a Quote</h2>
                <p>Fill out the form below and we'll get back to you within one business day.</p>

                <form class="contact-form" id="contact-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="firstname">First Name *</label>
                            <input type="text" id="firstname" name="firstname" required>
                        </div>
                        <div class="form-group">
                            <label for="lastname">Last Name *</label>
                            <input type="text" id="lastname" name="lastname" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="email">Email *</label>
                            <input type="email" id="email" name="email" required>
                        </div>
                        <div class="form-group">
                            <label for="phone">Phone</label>
                            <input type="tel" id="phone" name="phone">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="company">Company *</label>
                            <input type="text" id="company" name="company" required>
                        </div>
                        <div class="form-group">
                            <label for="project_type">Project Type</label>
                            <select id="project_type" name="project_type">
                                <option value="">Select a project type</option>
                                <option value="Robotic Cells">Robotic Cells</option>
                                <option value="Welding Automation">Welding Automation</option>
                                <option value="Test Systems">Test Systems</option>
                                <option value="Assembly Machines">Assembly Machines</option>
                                <option value="Custom Automation">Custom Automation</option>
                                <option value="Material Handling">Material Handling</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="message">Project Description *</label>
                        <textarea id="message" name="message" rows="5" required placeholder="Tell us about your project, including parts, volumes, and any specific requirements."></textarea>
                    </div>

                    <div id="form-status" class="form-status"></div>

                    <button type="submit" class="btn btn-primary btn-lg btn-block" id="submit-btn">Submit Request</button>
                </form>
            </div>
        </div>
    </div>
</section>

<!-- Content from markdown (if any) -->
{% if content %}
<section class="section section-alt">
    <div class="container">
        <div class="content-body">
            {{ content | safe }}
        </div>
    </div>
</section>
{% endif %}
{% endblock %}

{% block scripts_extra %}
<script>
// HubSpot Form Integration
(function() {
    // HubSpot Configuration - UPDATE THESE VALUES
    const HUBSPOT_PORTAL_ID = '{{ config.hubspot.portal_id | default("YOUR_PORTAL_ID") }}';
    const HUBSPOT_FORM_ID = '{{ config.hubspot.form_id | default("YOUR_FORM_ID") }}';

    const form = document.getElementById('contact-form');
    const submitBtn = document.getElementById('submit-btn');
    const formStatus = document.getElementById('form-status');

    if (!form) return;

    form.addEventListener('submit', async function(e) {
        e.preventDefault();

        // Check if HubSpot is configured
        if (HUBSPOT_PORTAL_ID === 'YOUR_PORTAL_ID' || HUBSPOT_FORM_ID === 'YOUR_FORM_ID') {
            formStatus.innerHTML = '<p class="error">Form not configured. Please contact us directly.</p>';
            return;
        }

        // Disable submit button
        submitBtn.disabled = true;
        submitBtn.textContent = 'Sending...';
        formStatus.innerHTML = '';

        // Collect form data - using HubSpot default field names
        const projectType = document.getElementById('project_type').value;
        const messageText = document.getElementById('message').value;
        const fullMessage = projectType ? `[Project Type: ${projectType}]\n\n${messageText}` : messageText;

        const formData = {
            fields: [
                { name: 'firstname', value: document.getElementById('firstname').value },
                { name: 'lastname', value: document.getElementById('lastname').value },
                { name: 'email', value: document.getElementById('email').value },
                { name: 'phone', value: document.getElementById('phone').value || '' },
                { name: 'company', value: document.getElementById('company').value },
                { name: 'message', value: fullMessage }
            ],
            context: {
                pageUri: window.location.href,
                pageName: document.title
            }
        };

        try {
            const response = await fetch(
                `https://api.hsforms.com/submissions/v3/integration/submit/${HUBSPOT_PORTAL_ID}/${HUBSPOT_FORM_ID}`,
                {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                }
            );

            if (response.ok) {
                formStatus.innerHTML = '<p class="success">Thank you! Your request has been submitted. We\'ll be in touch within one business day.</p>';
                form.reset();
            } else {
                const errorData = await response.json();
                console.error('HubSpot error:', errorData);
                formStatus.innerHTML = '<p class="error">There was an error submitting your request. Please try again or contact us directly.</p>';
            }
        } catch (error) {
            console.error('Submission error:', error);
            formStatus.innerHTML = '<p class="error">There was an error submitting your request. Please try again or contact us directly.</p>';
        }

        // Re-enable submit button
        submitBtn.disabled = false;
        submitBtn.textContent = 'Submit Request';
    });
})();
</script>
{% endblock %}
