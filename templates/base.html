<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page.title }}{{ config.seo.default_title_suffix }}</title>

    <!-- Security Meta Tags -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://www.googletagmanager.com https://www.google-analytics.com https://www.google.com https://www.gstatic.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; img-src 'self' data: https:; font-src 'self' https://fonts.gstatic.com; connect-src 'self' https://api.hsforms.com https://www.google-analytics.com https://analytics.google.com https://region1.google-analytics.com https://www.google.com; frame-src https://www.google.com; frame-ancestors 'self';">

    <!-- SEO Meta Tags -->
    <meta name="description" content="{{ page.description or config.seo.default_description }}">
    <meta name="keywords" content="{{ page.keywords or config.seo.default_keywords }}">
    <meta name="author" content="{{ config.site.author }}">

    <!-- Open Graph -->
    <meta property="og:title" content="{{ page.title }}{{ config.seo.default_title_suffix }}">
    <meta property="og:description" content="{{ page.description or config.seo.default_description }}">
    <meta property="og:type" content="{% if page.template == 'blog-post.html' %}article{% else %}website{% endif %}">
    <meta property="og:url" content="{{ config.site.url }}{{ page.url }}">
    <meta property="og:site_name" content="{{ config.site.name }}">
    <meta property="og:image" content="{{ config.site.url }}{{ config.site.base_path }}/static/images/{{ page.image | default('og-default.jpg') }}">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ page.title }}{{ config.seo.default_title_suffix }}">
    <meta name="twitter:description" content="{{ page.description or config.seo.default_description }}">
    <meta name="twitter:image" content="{{ config.site.url }}{{ config.site.base_path }}/static/images/{{ page.image | default('og-default.jpg') }}">

    <!-- Canonical URL -->
    <link rel="canonical" href="{{ config.site.url }}{{ page.url }}">

    <!-- Organization Schema -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "{{ config.site.name }}",
        "url": "{{ config.site.url }}",
        "logo": "{{ config.site.url }}/static/images/logo.png",
        "description": "{{ config.seo.default_description }}",
        "contactPoint": {
            "@type": "ContactPoint",
            "telephone": "{{ config.social.phone }}",
            "contactType": "sales"
        },
        "address": {
            "@type": "PostalAddress",
            "streetAddress": "{{ config.social.address }}"
        },
        "sameAs": []
    }
    </script>

    <!-- BreadcrumbList Schema -->
    {% if page.url != '/' %}
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
            {
                "@type": "ListItem",
                "position": 1,
                "name": "Home",
                "item": "{{ config.site.url }}"
            }
            {% set parts = page.url.strip('/').split('/') %}
            {% for part in parts %}
            ,{
                "@type": "ListItem",
                "position": {{ loop.index + 1 }},
                "name": "{{ part | replace('-', ' ') | title }}",
                "item": "{{ config.site.url }}/{{ parts[:loop.index] | join('/') }}/"
            }
            {% endfor %}
        ]
    }
    </script>
    {% endif %}

    <!-- Favicons & App Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="{{ config.site.base_path }}/static/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ config.site.base_path }}/static/images/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="{{ config.site.base_path }}/static/images/apple-touch-icon.png">
    <link rel="icon" sizes="192x192" href="{{ config.site.base_path }}/static/images/android-chrome-192x192.png">
    <meta name="theme-color" content="#003087">

    <!-- DNS Prefetch & Preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="https://www.google.com">

    <!-- Preload critical resources -->
    {% if page.url == '/' %}
    <link rel="preload" href="{{ config.site.base_path }}/static/images/hero-automation.jpg" as="image" fetchpriority="high">
    {% endif %}

    <!-- Main CSS -->
    <link rel="stylesheet" href="{{ config.site.base_path }}/static/css/style.css?v=20260122b">

    <!-- Fonts - Load async to prevent render blocking (display=swap shows fallback first) -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Roboto+Condensed:ital,wght@1,700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Roboto+Condensed:ital,wght@1,700&display=swap"></noscript>

    {% block head_extra %}{% endblock %}
</head>
<body>
    <!-- Combined Sticky Header Wrapper -->
    <div class="header-wrapper">
        <!-- Header Top Bar -->
        <div class="header-top-bar">
            <div class="container">
                <div class="top-bar-content">
                    <div class="top-bar-contact">
                        <a href="tel:{{ config.social.phone | replace('(', '') | replace(')', '') | replace(' ', '') | replace('-', '') }}">
                            <svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>
                            {{ config.social.phone }}
                        </a>
                    </div>
                    <nav class="top-bar-nav">
                        <a href="{{ config.site.base_path }}/services/">All Services</a>
                        <a href="{{ config.site.base_path }}/services/spare-parts/">Spare Parts</a>
                        <a href="{{ config.site.base_path }}/services/maintenance-support/">24/7 Support</a>
                        <a href="{{ config.site.base_path }}/itar/" class="itar-notice-link">ITAR Notice</a>
                    </nav>
                </div>
            </div>
        </div>

        <!-- Header -->
        <header class="site-header">
        <div class="container">
            <div class="header-inner">
                <a href="{{ config.site.base_path }}/" class="logo">
                    <span class="logo-text"><span class="logo-amd">AMD</span> <span class="logo-machines">MACHINES</span></span>
                </a>

                <nav class="main-nav" id="main-nav">
                    <ul class="nav-list">
                        {% for item in config.navigation %}
                        <li class="nav-item{% if item.children %} has-dropdown{% endif %}">
                            <a href="{{ config.site.base_path }}{{ item.url }}" class="nav-link {% if page.url == item.url or (item.url != '/' and page.url and page.url.startswith(item.url)) %}active{% endif %}">
                                {{ item.name }}
                            </a>
                            {% if item.children %}
                            <div class="dropdown-menu{% if item.name == 'Solutions' or item.name == 'Industries' %} dropdown-wide{% endif %}">
                                <div class="dropdown-content">
                                    {% for child in item.children %}
                                    <a href="{{ config.site.base_path }}{{ child.url }}" class="dropdown-item{% if child.featured %} dropdown-item-featured{% endif %}">
                                        <span class="dropdown-item-title">{{ child.name }}{% if child.featured %}<span class="nav-featured-badge">Core Expertise</span>{% endif %}</span>
                                        {% if child.description %}<span class="dropdown-item-desc">{{ child.description }}</span>{% endif %}
                                    </a>
                                    {% endfor %}
                                </div>
                            </div>
                            {% endif %}
                        </li>
                        {% endfor %}
                    </ul>
                </nav>

                <button class="mobile-menu-btn" id="mobile-menu-btn" aria-label="Toggle menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </header>
    </div><!-- End header-wrapper -->

    <!-- Main Content -->
    <main class="site-main">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer CTA Section (hidden on contact page) -->
    {% if page.template != 'contact.html' %}
    <section class="footer-cta">
        <div class="container">
            <div class="footer-cta-grid">
                <div class="footer-cta-content">
                    <h2>Ready to Automate?</h2>
                    <p>Tell us about your project. We've built 2,500+ machines over 30 years - chances are we've solved something similar.</p>
                    <ul class="footer-cta-features">
                        <li>Free Consultation</li>
                        <li>Custom Solutions</li>
                        <li>Expert Engineering</li>
                    </ul>
                </div>
                <div class="footer-cta-form">
                    <h3>Request a Quote</h3>
                    <p class="form-response-time"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12,6 12,12 16,14"/></svg> We respond in under 3 hours on weekdays</p>
                    <form class="quick-contact-form" id="footer-contact-form">
                        <div class="form-row">
                            <input type="text" name="firstname" placeholder="First Name *" required>
                            <input type="text" name="lastname" placeholder="Last Name *" required>
                        </div>
                        <input type="email" name="email" placeholder="Email *" required>
                        <input type="text" name="company" placeholder="Company *" required>
                        <input type="tel" name="phone" placeholder="Phone">
                        <textarea name="message" placeholder="Tell us about your project..." rows="3"></textarea>
                        <div id="footer-form-status" class="form-status"></div>
                        <button type="submit" class="btn btn-orange btn-block">Get Started</button>
                    </form>
                </div>
            </div>
        </div>
    </section>
    {% endif %}

    <!-- Mega Footer -->
    <footer class="mega-footer">
        <div class="container">
            <div class="mega-footer-grid">
                <!-- Brand Column -->
                <div class="mega-footer-brand">
                    <a href="{{ config.site.base_path }}/" class="mega-footer-logo mega-footer-logo-full">
                        <strong>Advanced Manufacturing Development LLC</strong>
                    </a>
                    <p>{{ config.site.tagline }}</p>
                    <ul class="mega-footer-contact">
                        <li><a href="tel:{{ config.social.phone | replace('(', '') | replace(')', '') | replace(' ', '') | replace('-', '') }}">{{ config.social.phone }}</a></li>
                        <li class="address">{{ config.social.address }}</li>
                    </ul>
                </div>

                <!-- Solutions Column -->
                <div class="mega-footer-col">
                    <h4>Solutions</h4>
                    <ul class="mega-footer-links">
                        <li><a href="{{ config.site.base_path }}/solutions/robotic-cells/">Robotic Cells</a></li>
                        <li><a href="{{ config.site.base_path }}/solutions/welding/">Welding Automation</a></li>
                        <li><a href="{{ config.site.base_path }}/solutions/assembly/">Assembly Systems</a></li>
                        <li><a href="{{ config.site.base_path }}/solutions/machine-vision/">Machine Vision</a></li>
                        <li><a href="{{ config.site.base_path }}/solutions/test-systems/">Test & Inspection</a></li>
                        <li><a href="{{ config.site.base_path }}/solutions/material-handling/">Material Handling</a></li>
                        <li><a href="{{ config.site.base_path }}/solutions/palletizing/">Palletizing</a></li>
                    </ul>
                    <div class="mega-footer-view-all">
                        <a href="{{ config.site.base_path }}/solutions/">View all solutions →</a>
                    </div>
                </div>

                <!-- Industries Column -->
                <div class="mega-footer-col">
                    <h4>Industries</h4>
                    <ul class="mega-footer-links">
                        <li><a href="{{ config.site.base_path }}/industries/automotive/">Automotive</a></li>
                        <li><a href="{{ config.site.base_path }}/industries/medical/">Medical Devices</a></li>
                        <li><a href="{{ config.site.base_path }}/industries/aerospace/">Aerospace</a></li>
                        <li><a href="{{ config.site.base_path }}/industries/electronics/">Electronics</a></li>
                        <li><a href="{{ config.site.base_path }}/industries/consumer/">Consumer Products</a></li>
                        <li><a href="{{ config.site.base_path }}/industries/food-beverage/">Food & Beverage</a></li>
                        <li><a href="{{ config.site.base_path }}/industries/pharmaceutical/">Pharmaceutical</a></li>
                    </ul>
                    <div class="mega-footer-view-all">
                        <a href="{{ config.site.base_path }}/industries/">View all industries →</a>
                    </div>
                </div>

                <!-- Services Column -->
                <div class="mega-footer-col">
                    <h4>Services</h4>
                    <ul class="mega-footer-links">
                        <li><a href="{{ config.site.base_path }}/services/robot-programming/">Robot Programming</a></li>
                        <li><a href="{{ config.site.base_path }}/services/process-optimization/">Process Optimization</a></li>
                        <li><a href="{{ config.site.base_path }}/services/spare-parts/">Spare Parts</a></li>
                        <li><a href="{{ config.site.base_path }}/services/digital-twins/">Digital Twins</a></li>
                        <li><a href="{{ config.site.base_path }}/services/upgrades-retrofits/">Upgrades & Retrofits</a></li>
                        <li><a href="{{ config.site.base_path }}/services/training/">Training</a></li>
                        <li><a href="{{ config.site.base_path }}/services/maintenance-support/">Maintenance & Support</a></li>
                    </ul>
                    <div class="mega-footer-view-all">
                        <a href="{{ config.site.base_path }}/services/">View all services &rarr;</a>
                    </div>
                </div>

                <!-- Company Column -->
                <div class="mega-footer-col">
                    <h4>Company</h4>
                    <ul class="mega-footer-links">
                        <li><a href="{{ config.site.base_path }}/about/">About AMD Automation</a></li>
                        <li><a href="{{ config.site.base_path }}/contact/">Contact Us</a></li>
                        <li><a href="{{ config.site.base_path }}/contact/">Request a Quote</a></li>
                    </ul>
                    <h4 style="margin-top: 1.5rem;">Quick Links</h4>
                    <ul class="mega-footer-links">
                        <li><a href="{{ config.site.base_path }}/solutions/">All Solutions</a></li>
                        <li><a href="{{ config.site.base_path }}/industries/">All Industries</a></li>
                        <li><a href="{{ config.site.base_path }}/blog/">All Articles</a></li>
                    </ul>
                </div>
            </div>

            <div class="mega-footer-bottom">
                <p class="mega-footer-copy">&copy; {{ year }} Advanced Manufacturing Development LLC. All rights reserved.</p>
                <div class="mega-footer-legal">
                    <a href="{{ config.site.base_path }}/itar/">ITAR Notice</a>
                    <span class="legal-sep">&bull;</span>
                    <a href="{{ config.site.base_path }}/privacy-policy/">Privacy Policy</a>
                    <span class="legal-sep">&bull;</span>
                    <a href="{{ config.site.base_path }}/contact/">Contact</a>
                </div>
                <p class="mega-footer-disclaimer">All brand names, trademarks, and logos referenced on this site are the property of their respective owners and are used for reference purposes only.</p>
            </div>
        </div>
    </footer>

    <!-- Scripts (deferred for performance) -->
    <script src="{{ config.site.base_path }}/static/js/main.js" defer></script>

    <!-- Google Analytics handled by Cloudflare Zaraz -->

    <!-- Lightweight Analytics (A/B tracking via Cloudflare Zaraz) -->
    <script>
    window.abTrack = function(el) {
        if (typeof gtag === 'function') {
            gtag('event', 'click', { event_category: 'content', event_label: el.textContent.substring(0,50) });
        }
    };
    </script>

    <!-- Google reCAPTCHA v3 - Lazy loaded on form interaction for performance -->
    <script>
    (function() {
        var recaptchaLoaded = false;
        var RECAPTCHA_KEY = '6LdSKVIsAAAAAAcVpAO4PCEzDjEmGOpfo1jK0wMS';

        function loadRecaptcha() {
            if (recaptchaLoaded) return;
            recaptchaLoaded = true;
            var script = document.createElement('script');
            script.src = 'https://www.google.com/recaptcha/api.js?render=' + RECAPTCHA_KEY;
            script.async = true;
            document.head.appendChild(script);
        }

        // Load reCAPTCHA when user interacts with any form
        document.addEventListener('focusin', function(e) {
            if (e.target.closest('form')) loadRecaptcha();
        }, { once: true });

        // Also load on mouse enter to forms (desktop hover)
        document.addEventListener('mouseover', function(e) {
            if (e.target.closest('form')) loadRecaptcha();
        }, { once: true });
    })();
    </script>

    {% block scripts_extra %}{% endblock %}
</body>
</html>
