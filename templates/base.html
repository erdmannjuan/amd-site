<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page.title }}{{ config.seo.default_title_suffix }}</title>

    <!-- Google Analytics 4 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1S337NW9CQ"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-1S337NW9CQ');
    </script>

    <!-- Security Meta Tags -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://www.googletagmanager.com https://www.google-analytics.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; img-src 'self' data: https:; font-src 'self' https://fonts.gstatic.com; connect-src 'self' https://api.hsforms.com https://www.google-analytics.com https://analytics.google.com https://region1.google-analytics.com; frame-ancestors 'self';">

    <!-- SEO Meta Tags -->
    <meta name="description" content="{{ page.description or config.seo.default_description }}">
    <meta name="keywords" content="{{ page.keywords or config.seo.default_keywords }}">
    <meta name="author" content="{{ config.site.author }}">

    <!-- Open Graph -->
    <meta property="og:title" content="{{ page.title }}">
    <meta property="og:description" content="{{ page.description or config.seo.default_description }}">
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ config.site.url }}{{ page.url }}">
    {% if page.image %}
    <meta property="og:image" content="{{ config.site.url }}{{ config.site.base_path }}/static/images/{{ page.image }}">
    {% endif %}

    <!-- Canonical URL -->
    <link rel="canonical" href="{{ config.site.url }}{{ page.url }}">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{{ config.site.base_path }}/static/images/favicon.png">

    <!-- DNS Prefetch & Preconnect for Performance -->
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.gstatic.com">
    <link rel="dns-prefetch" href="https://www.googletagmanager.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Preload Critical CSS -->
    <link rel="preload" href="{{ config.site.base_path }}/static/css/style.css" as="style">

    <!-- Fonts with display=swap for better performance -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Roboto+Condensed:ital,wght@1,700&display=swap" rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="{{ config.site.base_path }}/static/css/style.css">

    {% block head_extra %}{% endblock %}
</head>
<body>
    <!-- Combined Sticky Header Wrapper -->
    <div class="header-wrapper">
        <!-- Header Top Bar -->
        <div class="header-top-bar">
            <div class="container">
                <div class="top-bar-content">
                    <div class="top-bar-contact">
                        <a href="tel:{{ config.social.phone | replace('(', '') | replace(')', '') | replace(' ', '') | replace('-', '') }}">
                            <svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>
                            {{ config.social.phone }}
                        </a>
                        <a href="mailto:{{ config.social.email }}">
                            <svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
                            {{ config.social.email }}
                        </a>
                    </div>
                    <nav class="top-bar-nav">
                        <a href="{{ config.site.base_path }}/services/">All Services</a>
                        <a href="{{ config.site.base_path }}/services/spare-parts/">Spare Parts</a>
                        <a href="{{ config.site.base_path }}/services/maintenance-support/">24/7 Support</a>
                        <a href="{{ config.site.base_path }}/itar/" class="itar-notice-link">ITAR Notice</a>
                    </nav>
                </div>
            </div>
        </div>

        <!-- Header -->
        <header class="site-header">
        <div class="container">
            <div class="header-inner">
                <a href="{{ config.site.base_path }}/" class="logo">
                    <span class="logo-text"><span class="logo-amd">AMD</span> <span class="logo-machines">MACHINES</span></span>
                </a>

                <nav class="main-nav" id="main-nav">
                    <ul class="nav-list">
                        {% for item in config.navigation %}
                        <li class="nav-item{% if item.children %} has-dropdown{% endif %}">
                            <a href="{{ config.site.base_path }}{{ item.url }}" class="nav-link {% if page.url == item.url or (item.url != '/' and page.url and page.url.startswith(item.url)) %}active{% endif %}">
                                {{ item.name }}
                            </a>
                            {% if item.children %}
                            <div class="dropdown-menu{% if item.name == 'Solutions' or item.name == 'Industries' %} dropdown-wide{% endif %}">
                                <div class="dropdown-content">
                                    {% for child in item.children %}
                                    <a href="{{ config.site.base_path }}{{ child.url }}" class="dropdown-item">
                                        <span class="dropdown-item-title">{{ child.name }}</span>
                                        {% if child.description %}<span class="dropdown-item-desc">{{ child.description }}</span>{% endif %}
                                    </a>
                                    {% endfor %}
                                </div>
                            </div>
                            {% endif %}
                        </li>
                        {% endfor %}
                    </ul>
                </nav>

                <button class="mobile-menu-btn" id="mobile-menu-btn" aria-label="Toggle menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </header>
    </div><!-- End header-wrapper -->

    <!-- Main Content -->
    <main class="site-main">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer CTA Section -->
    <section class="footer-cta">
        <div class="container">
            <div class="footer-cta-grid">
                <div class="footer-cta-content">
                    <h2>Ready to Automate Your Production?</h2>
                    <p>Let's discuss how custom automation solutions can transform your manufacturing operations. Our engineers are ready to help you increase efficiency, quality, and throughput.</p>
                    <ul class="footer-cta-features">
                        <li>Free Consultation</li>
                        <li>Custom Solutions</li>
                        <li>Expert Engineering</li>
                    </ul>
                </div>
                <div class="footer-cta-form">
                    <h3>Request a Quote</h3>
                    <p class="form-response-time"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12,6 12,12 16,14"/></svg> We respond in under 3 hours on weekdays</p>
                    <form class="quick-contact-form" id="footer-contact-form">
                        <div class="form-row">
                            <input type="text" name="firstname" placeholder="First Name *" required>
                            <input type="text" name="lastname" placeholder="Last Name *" required>
                        </div>
                        <input type="email" name="email" placeholder="Email *" required>
                        <input type="text" name="company" placeholder="Company *" required>
                        <input type="tel" name="phone" placeholder="Phone">
                        <textarea name="message" placeholder="Tell us about your project..." rows="3"></textarea>
                        <div id="footer-form-status" class="form-status"></div>
                        <button type="submit" class="btn btn-orange btn-block">Get Started</button>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- Mega Footer -->
    <footer class="mega-footer">
        <div class="container">
            <div class="mega-footer-grid">
                <!-- Brand Column -->
                <div class="mega-footer-brand">
                    <a href="{{ config.site.base_path }}/" class="mega-footer-logo mega-footer-logo-full">
                        <strong>Advanced Manufacturing Development LLC</strong>
                    </a>
                    <p>{{ config.site.tagline }}</p>
                    <ul class="mega-footer-contact">
                        <li><a href="tel:{{ config.social.phone | replace('(', '') | replace(')', '') | replace(' ', '') | replace('-', '') }}">{{ config.social.phone }}</a></li>
                        <li><a href="mailto:{{ config.social.email }}">{{ config.social.email }}</a></li>
                        <li class="address">{{ config.social.address }}</li>
                    </ul>
                </div>

                <!-- Solutions Column -->
                <div class="mega-footer-col">
                    <h4>Solutions</h4>
                    <ul class="mega-footer-links">
                        <li><a href="{{ config.site.base_path }}/solutions/robotic-cells/">Robotic Cells</a></li>
                        <li><a href="{{ config.site.base_path }}/solutions/welding/">Welding Automation</a></li>
                        <li><a href="{{ config.site.base_path }}/solutions/assembly/">Assembly Systems</a></li>
                        <li><a href="{{ config.site.base_path }}/solutions/machine-vision/">Machine Vision</a></li>
                        <li><a href="{{ config.site.base_path }}/solutions/test-systems/">Test & Inspection</a></li>
                        <li><a href="{{ config.site.base_path }}/solutions/material-handling/">Material Handling</a></li>
                        <li><a href="{{ config.site.base_path }}/solutions/palletizing/">Palletizing</a></li>
                    </ul>
                    <div class="mega-footer-view-all">
                        <a href="{{ config.site.base_path }}/solutions/">View all solutions →</a>
                    </div>
                </div>

                <!-- Industries Column -->
                <div class="mega-footer-col">
                    <h4>Industries</h4>
                    <ul class="mega-footer-links">
                        <li><a href="{{ config.site.base_path }}/industries/automotive/">Automotive</a></li>
                        <li><a href="{{ config.site.base_path }}/industries/medical/">Medical Devices</a></li>
                        <li><a href="{{ config.site.base_path }}/industries/aerospace/">Aerospace</a></li>
                        <li><a href="{{ config.site.base_path }}/industries/electronics/">Electronics</a></li>
                        <li><a href="{{ config.site.base_path }}/industries/consumer/">Consumer Products</a></li>
                        <li><a href="{{ config.site.base_path }}/industries/food-beverage/">Food & Beverage</a></li>
                        <li><a href="{{ config.site.base_path }}/industries/pharmaceutical/">Pharmaceutical</a></li>
                    </ul>
                    <div class="mega-footer-view-all">
                        <a href="{{ config.site.base_path }}/industries/">View all industries →</a>
                    </div>
                </div>

                <!-- Services Column -->
                <div class="mega-footer-col">
                    <h4>Services</h4>
                    <ul class="mega-footer-links">
                        <li><a href="{{ config.site.base_path }}/services/robot-programming/">Robot Programming</a></li>
                        <li><a href="{{ config.site.base_path }}/services/process-optimization/">Process Optimization</a></li>
                        <li><a href="{{ config.site.base_path }}/services/spare-parts/">Spare Parts</a></li>
                        <li><a href="{{ config.site.base_path }}/services/digital-twins/">Digital Twins</a></li>
                        <li><a href="{{ config.site.base_path }}/services/upgrades-retrofits/">Upgrades & Retrofits</a></li>
                        <li><a href="{{ config.site.base_path }}/services/training/">Training</a></li>
                        <li><a href="{{ config.site.base_path }}/services/maintenance-support/">Maintenance & Support</a></li>
                    </ul>
                    <div class="mega-footer-view-all">
                        <a href="{{ config.site.base_path }}/services/">View all services &rarr;</a>
                    </div>
                </div>

                <!-- Company Column -->
                <div class="mega-footer-col">
                    <h4>Company</h4>
                    <ul class="mega-footer-links">
                        <li><a href="{{ config.site.base_path }}/about/">About AMD Automation</a></li>
                        <li><a href="{{ config.site.base_path }}/contact/">Contact Us</a></li>
                        <li><a href="{{ config.site.base_path }}/contact/">Request a Quote</a></li>
                    </ul>
                    <h4 style="margin-top: 1.5rem;">Quick Links</h4>
                    <ul class="mega-footer-links">
                        <li><a href="{{ config.site.base_path }}/solutions/">All Solutions</a></li>
                        <li><a href="{{ config.site.base_path }}/industries/">All Industries</a></li>
                        <li><a href="{{ config.site.base_path }}/blog/">All Articles</a></li>
                    </ul>
                </div>
            </div>

            <div class="mega-footer-bottom">
                <p class="mega-footer-copy">&copy; {{ year }} Advanced Manufacturing Development LLC. All rights reserved.</p>
                <div class="mega-footer-legal">
                    <a href="{{ config.site.base_path }}/itar/" class="itar-notice-link">ITAR Notice</a>
                    <a href="{{ config.site.base_path }}/privacy-policy/">Privacy Policy</a>
                    <a href="{{ config.site.base_path }}/contact/">Contact</a>
                </div>
                <p class="mega-footer-disclaimer">All brand names, trademarks, and logos referenced on this site are the property of their respective owners and are used for reference purposes only.</p>
            </div>
        </div>
    </footer>

    <!-- Scripts (deferred for performance) -->
    <script src="{{ config.site.base_path }}/static/js/main.js" defer></script>

    <!-- A/B Testing & Analytics -->
    <script>
    (function() {
        // A/B Test Configuration
        var AB_TESTS = {
            'related_content': {
                variants: ['control', 'variant_a', 'variant_b'],
                active: true
            }
        };

        // Get or assign user to variant
        function getVariant(testName) {
            var storageKey = 'ab_' + testName;
            var variant = localStorage.getItem(storageKey);
            if (!variant && AB_TESTS[testName]) {
                var variants = AB_TESTS[testName].variants;
                variant = variants[Math.floor(Math.random() * variants.length)];
                localStorage.setItem(storageKey, variant);
            }
            return variant;
        }

        // Track event to Google Analytics
        function trackEvent(category, action, label, value) {
            if (typeof gtag === 'function') {
                gtag('event', action, {
                    'event_category': category,
                    'event_label': label,
                    'value': value
                });
            }
        }

        // Track content clicks with A/B variant info
        function trackContentClick(element) {
            var contentId = element.getAttribute('data-content-id') || element.textContent.trim().substring(0, 50);
            var testSection = element.closest('[data-test]');
            var testName = testSection ? testSection.getAttribute('data-test') : 'unknown';
            var variant = getVariant(testName);

            trackEvent('content_click', 'click', contentId, 1);
            trackEvent('ab_test', testName + '_' + variant, contentId, 1);

            // Log for debugging (remove in production)
            console.log('A/B Track:', testName, variant, contentId);
        }

        // Initialize tracking on DOM ready
        document.addEventListener('DOMContentLoaded', function() {
            // Track clicks on related content
            var trackableLinks = document.querySelectorAll('[data-test] a, .related-post-card, .related-item');
            trackableLinks.forEach(function(link) {
                link.addEventListener('click', function() {
                    trackContentClick(this);
                });
            });

            // Track sidebar related article clicks
            var sidebarLinks = document.querySelectorAll('.article-related a');
            sidebarLinks.forEach(function(link) {
                link.addEventListener('click', function() {
                    trackEvent('sidebar', 'related_click', this.textContent.trim().substring(0, 50), 1);
                });
            });

            // Expose for manual tracking
            window.abTrack = trackContentClick;
        });
    })();
    </script>

    {% block scripts_extra %}{% endblock %}
</body>
</html>
